<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detail Akun } Jajan Yuk</title>
    <!-- Favicon -->
    <link rel="shortcut icon" href="../images/chicken.svg" type="image/x-icon">
    <!-- Fonts Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css">
    <!-- Bootstrap -->
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <!-- Swiper.js -->
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css">
    <!-- User Defined Styles -->
    <link rel="stylesheet" href="../css/style.css">
    <!-- Manifest.json -->
    <link rel="manifest" href="./manifest.json">
    <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
    <style>
        a.text-orange:hover, a:active {
            color: #fda766;
        }
        a:hover {
            text-decoration: none;
        }
        @media screen and (min-width:992px){
            #product-recommendation {
                margin-top: 7rem !important;
            }
            .modal-lg {
                width: 693px;
            }
            .modal-content {
                position: absolute;
                top: 40px;
                right: 56px;
                border-radius: 0;
            }
        }
        @media screen and (max-width:992px){
            #product-recommendation {
                margin-top: 4rem !important;
            }
            .modal-content {
                top: 70px;
                right: 0;
            }
        }
        .list-group-item {
            transition-duration: 175ms;
        }
        .list-group-item:hover {
            background: #efefef;
            cursor: pointer;
        }
        .hovered:hover {
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm fixed-top" id="navbar" style="z-index: 9999;">
        <div class="container">
            <a href="#" class="navbar-brand font-weight-bold d-none d-lg-block">JAJAN YUK</a>
            <form action="#" class="mx-auto w-100 d-lg-none">
                <div class="input-group">
                    <input type="text" name="jajanan" id="jajanan" class="form-control border-0 menu-search" placeholder="Cari Jajanan Yuk..." data-toggle="modal" data-target="#modal-small" autocomplete="off">
                    <div class="input-group-append">
                        <button class="btn btn-primary" type="button" id="cari_jajanan"><i class="fas fa-search"></i></button>
                    </div>
                </div>
            </form>
            <div class="collapse navbar-collapse">
                <form action="#" class="mx-auto w-75">
                    <div class="input-group">
                        <input type="text" name="jajanan" id="jajanan" class="form-control menu-search" placeholder="Cari Jajanan Yuk..." data-toggle="modal" data-target="#modal-large" autocomplete="off">
                        <div class="input-group-append">
                            <button class="btn btn-primary" type="button" id="cari_jajanan"><i class="fas fa-search"></i></button>
                        </div>
                    </div>
                </form>
                <ul class="my-2" id="customer-auth-nav">
                    <a href="./customer/login.html" class="btn bg-white border-primary">Masuk</a>
                    <a href="./customer/register.html" class="btn btn-primary">Daftar</a>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Account Detail -->
    <section class="bg-white mt-5 mb-5 my-lg-4 py-4">
    </section>

    <!-- Footer On Dekstop -->
    <footer id="footer" class="bg-dark d-none d-lg-block text-white text-center py-4 ">
        <div class="container">
            <div class="row mb-4">
                <div class="col-md-4 text-md-left mr-auto">
                    <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Dolores provident itaque in eveniet qui eaque voluptatum sint cum laborum dicta velit officiis animi exercitationem modi, quos nulla reiciendis! Veniam, temporibus?</p>
                </div>
                <div class="col-md-4 text-md-left mx-auto mt-4 mt-md-0">
                    <ul class="nav flex-column">
                        <li class="nav-item"><a href="#" class="nav-link text-white">About Us</a></li>
                        <li class="nav-item"><a href="#" class="nav-link text-white">Blog</a></li>
                        <li class="nav-item"><a href="#" class="nav-link text-white">Privacy Policy</a></li>
                        <li class="nav-item"><a href="#" class="nav-link text-white">Terms Of Service</a></li>
                        <li class="nav-item"><a href="#" class="nav-link text-white">FAQ</a></li>
                    </ul>
                </div>
            </div>
            <hr class="w-100 bg-white">
            <div class="row text-center">
                <div class="col-12">
                    <p class="small">&copy; 2020 <br /> Lorem ipsum dolor sit amet consectetur adipisicing elit. Corporis corrupti nobis, itaque omnis nesciunt quae eveniet nemo perspiciatis cumque cupiditate?</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bottom Navigation Bar On Mobile -->
    <nav class="bg-white border-top fixed-bottom d-lg-none d-flex justify-content-center align-items-center w-100 py-2">
        <a href="index.html" class="d-flex flex-column justify-content-center align-items-center flex-grow-1 text-orange small">
            <i class="fas fa-home text-small"></i>
            <span>Home</span>
        </a>
        <a href="#" class="d-flex flex-column justify-content-center align-items-center flex-grow-1 text-secondary small">
            <i class="fas fa-heart"></i>
            <span>Wishlist</span>
        </a>
        <a href="#" class="d-flex flex-column justify-content-center align-items-center flex-grow-1 text-secondary small">
            <i class="fas fa-shopping-cart"></i>
            <span>Cart</span>
        </a>
        <a href="#" class="d-flex flex-column justify-content-center align-items-center flex-grow-1 text-secondary small">
            <i class="fas fa-user"></i>
            <span>Account</span>
        </a>
    </nav>

    <!-- Modal Large -->
<div class="modal fade" id="modal-large" tabindex="-1" style="z-index: 99999;" data-focus="false">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-body">
            <ul class="list-group list-group-flush overflow-auto search-suggest search-suggest>
                <li class="list-group-item">Silahkan cari menu...</li>
            </ul>
        </div>
      </div>
    </div>
</div>

<!-- Modal Small -->
<div class="modal fade" id="modal-small" tabindex="-1" style="z-index: 99999;" data-focus="false">
    <div class="modal-dialog modal-small">
      <div class="modal-content">
        <div class="modal-body">
            <ul class="list-group list-group-flush overflow-auto search-suggest">
                <li class="list-group-item">Silahkan cari menu...</li>
            </ul>
        </div>
      </div>
    </div>
</div>
    
    <!-- Bootstrap -->
    <script src="../js/jquery-3.5.1.slim.min.js"></script>
    <script src="../js/popper.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script type="module">
        import {getProductOrderAPI} from "../js/services/api/customer/product-order.js";
        const CUSTOMER_TOKEN = JSON.parse(localStorage.getItem("CUSTOMER_TOKEN")) ?? null;
        if(CUSTOMER_TOKEN == null){
           location.href = "../index.html";
        }
        else {
            const CUSTOMER_TOKEN = JSON.parse(localStorage.getItem("CUSTOMER_TOKEN"));
            const {data: {access_token, refresh_token, customer: {name}}} = CUSTOMER_TOKEN;

            let urlParams = new URLSearchParams(window.location.search);
            let idParam = urlParams.get("status");

            const navbar = document.getElementById("navbar");
            navbar.classList.remove("py-3");
            const customerAuthNavLink = document.querySelectorAll("#customer-auth-nav a");
            customerAuthNavLink.forEach(element => {
                element.style.display = "none";
            });
            const customerAuthNavContainer = document.getElementById("customer-auth-nav");
            customerAuthNavContainer.innerHTML = `<a class="text-dark" href="../cart.html"><i class='bx bxs-cart bx-sm mr-4 hovered-icon'></i></a>
                                                    <a class="text-dark" href="./account-detail.html"><i class='bx bx-user bx-sm hovered-icon'></i></a>`;

            const customerNameContainer = document.getElementById("customer-name");
            customerNameContainer.innerHTML += name;

            getProductOrderAPI(access_token).then(response => {
                if(response.msg == "Token has been revoked"){
                    localStorage.removeItem("CUSTOMER_TOKEN");
                    location.href = "../index.html";
                }
                if(response.msg == "Success"){
                    const {data} = response;
                    const transactionContainer = document.getElementById("transaction-container");
                    const statusData = data.filter(element => {return element.status == idParam});
                    let dataStatusRaw = "";
                    if(statusData.length == 0){
                        dataStatusRaw = `Tidak ada produk dengan status ${idParam}`;
                    }
                    else {
                        statusData.forEach(element => {
                        const {codeOrder, dateOrder, status, finalPrice, kurir: {name}, confirmation} = element;
                        dataStatusRaw += `<div class="col-lg-4">
                                <div class="card-body bg-white">
                                    <div class="card">
                                        <div class="card-header">Data Pesanan</div>
                                        <div class="card-body">
                                            <ul class="list-group list-group-flush">
                                                <li class="list-group-item d-flex justify-content-between align-items-center">Code Order<span>${codeOrder}</span></li>
                                                <li class="list-group-item d-flex justify-content-between align-items-center">Code Confirmation<span>${confirmation == null ? "Information Not Found" : confirmation}</span></li>
                                                <li class="list-group-item d-flex justify-content-between align-items-center">Nama Kurir<span>${name == null ? "Information Not Found" : name}</span></li>
                                                <li class="list-group-item d-flex justify-content-between align-items-center">Date Order<span>${dateOrder}</span></li>
                                                <li class="list-group-item d-flex justify-content-between align-items-center">Final Price<span>${finalPrice}</span></li>
                                                <li class="list-group-item d-flex justify-content-between align-items-center">Status<span>${status}</span></li>
                                              </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>`;
                        });
                    }
                    const orderContainer = document.getElementById("order-container");
                    orderContainer.innerHTML = dataStatusRaw;
                }
            });
        }
    </script>
</body>
</html>